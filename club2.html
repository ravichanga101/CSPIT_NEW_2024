<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Club Details - CSPIT</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Lightbox CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/main.css" /> -->

    <style>
      :root {
        --primary-color: #0056b3;
        --secondary-color: #6c757d;
        --dark-color: #343a40;
        --light-color: #f8f9fa;
        --accent-color: #fd7e14;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f2f5;
      }
      ::-webkit-scrollbar {
        width: 10px;
      }

      ::-webkit-scrollbar-track {
        background: #adb2b7;
      }

      ::-webkit-scrollbar-thumb {
        background: #097bf5;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #097bf5;
      }
      .club-header {
        background: linear-gradient(135deg, #2081e9, #0056b3);
        color: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }
      .club-logo {
        width: 180px;
        height: 180px;
        object-fit: contain;
        background-color: white;
        border-radius: 50%;
        padding: 5px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .club-logo:hover {
        transform: scale(1.05);
      }

      .section-title {
        position: relative;
        padding-bottom: 15px;
        margin-bottom: 25px;
        color: var(--dark-color);
        font-weight: 600;
      }

      .section-title::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        width: 60px;
        height: 3px;
        background-color: var(--accent-color);
      }

      .faculty-card,
      .coordinator-card {
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        height: 100%;
      }

      .faculty-card:hover,
      .coordinator-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .faculty-img,
      .coordinator-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .about-section {
        background-color: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .event-card {
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }

      .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .event-img-container {
        overflow: hidden;
        position: relative;
        height: 200px;
      }

      .event-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.4s ease;
      }

      .event-card:hover .event-img {
        transform: scale(1.05);
      }

      .event-gallery-img {
        height: 160px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .event-gallery-img:hover {
        transform: scale(1.03);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .contact-icon {
        background-color: var(--primary-color);
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
      }
      .back-btn {
        display: inline-flex;
        align-items: center;
        padding: 8px 20px;
        background-color: white;
        color: var(--dark-color);
        border-radius: 30px;
        text-decoration: none;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }

      .back-btn:hover {
        background-color: var(--primary-color);
        color: white;
        transform: translateX(-5px);
      }

      .achievement-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--accent-color);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        z-index: 1;
      }

      /* Loading spinner */
      .loader-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 9999;
      }
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Loading Spinner -->
    <div class="loader-container" id="loader">
      <div class="loader"></div>
    </div>
    <div class="container py-5" id="club-container" style="display: none">
      <!-- Back Button -->
      <div class="d-flex justify-content-end align-items-center mb-4">
        <a href="./index.html#club-section" class="back-btn">
          <i class="fas fa-arrow-left me-2"></i> Back to Clubs
        </a>
      </div>
      <!-- Club Header -->
      <div class="club-header p-4 mb-5">
        <div class="row align-items-center">
          <div
            class="col-md-3 text-center text-md-start mb-4 mb-md-0"
            style="display: flex; justify-content: center"
          >
            <img
              id="club-logo"
              src="/placeholder.svg?height=150&width=150"
              alt="Club Logo"
              class="club-logo"
            />
          </div>
          <div class="col-md-9">
            <h1 class="display-4 fw-bold mb-2" id="club-name">Loading...</h1>
            <p class="lead mb-3" id="club-tagline">Loading...</p>
            <div class="d-flex flex-wrap mt-3" id="club-badges">
              <!-- Badges will be populated here -->
            </div>
          </div>
        </div>
      </div>
      <!-- About Section -->
      <div class="about-section mb-5">
        <h2 class="section-title">About the Club</h2>
        <p id="club-lead">
          The club aims to foster a community of enthusiasts who collaborate,
          learn, and grow together.
        </p>
        <p id="club-description">Loading...</p>
      </div>

      <!-- Faculty Advisors Section -->
      <h2 class="section-title">Faculty Advisors</h2>
      <div class="row mb-5" id="faculty-container">
        <!-- Faculty cards will be populated here -->
      </div>

      <!-- Student Coordinators Section -->
      <h2 class="section-title" id="student-coordinator">
        Student Coordinators
      </h2>
      <div class="row mb-5" id="coordinator-container">
        <!-- Coordinator cards will be populated here -->
      </div>

      <!-- Events Section -->
      <h2 class="section-title">Recent Events</h2>
      <div class="row mb-5" id="events-container">
        <!-- Event cards will be populated here -->
      </div>

      <!-- Events Gallery Section -->
      <h2 class="section-title">Events Gallery</h2>
      <div class="row mb-5" id="gallery-container">
        <!-- Gallery images will be populated here -->
      </div>
    </div>
    <!-- Event Gallery Modals Container -->
    <div id="modals-container">
      <!-- Event modals will be populated here -->
    </div>
    <!-- SheetJS (xlsx) library for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Lightbox JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
    <!-- Custom JS -->
    <script>
      // Global variables to store club data
      let clubData = {};
      let facultyData = [];
      let coordinatorData = [];
      let eventsData = [];
      let galleryData = [];

      // Function to get query parameter from the URL
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // Function to read Excel file and fetch data dynamically
      async function readExcelFile() {
        try {
          const response = await fetch("club.xlsx"); // Load the Excel file
          const arrayBuffer = await response.arrayBuffer();
          const data = new Uint8Array(arrayBuffer);
          const workbook = XLSX.read(data, { type: "array" });

          // Get the first sheet
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];

          // Convert to JSON
          const jsonData = XLSX.utils.sheet_to_json(worksheet);

          // Get club ID from URL (e.g., `club.html?club=coding`)
          const clubID = getQueryParam("club");

          if (!clubID) {
            alert("No club specified in the URL!");
            return;
          }

          // Find the matching club by ID
          const matchedClub = jsonData.find(
            (row) => row["Club ID"]?.toLowerCase() === clubID.toLowerCase()
          );

          if (!matchedClub) {
            alert("Club not found in the Excel file!");
            return;
          }

          // Process the matched row
          processClubData(matchedClub);
          populateUI();

          // Hide loader and show content
          document.getElementById("loader").classList.add("hidden");
          document.getElementById("club-container").style.display = "block";
        } catch (error) {
          console.error("Error reading Excel file:", error);
          alert("Error loading club data. Please try again later.");
        }
      }

      // Process club data from the single cell format for events
      function processClubData(data) {
        // Basic club info
        clubData = {
          id: data["Club ID"] || "",
          name: data["Club Name"] || "Club Name",
          logo: data["Logo"] || "",
          about: data["About"] || "About the club...",
        };

        // Process faculty coordinators
        if (data["Faculty Coordinators"]) {
          const facultyList = data["Faculty Coordinators"].split(";");
          facultyData = facultyList.map((faculty) => {
            const parts = faculty.trim().split(",");
            return {
              name: parts[0] || "",
              position: parts[1] || "",
              email: parts[2] || "",
              phone: parts[3] || "",
              image: parts[4] || "img/placeholder-profile.jpg",
            };
          });
        }

        // Process student coordinators
        if (data["Student Coordinators"]) {
          const coordinatorList = data["Student Coordinators"].split(";");
          coordinatorData = coordinatorList.map((coordinator) => {
            const parts = coordinator.trim().split(",");
            return {
              name: parts[0] || "",
              position: parts[1] || "",
              email: parts[2] || "",
              phone: parts[3] || "",
            };
          });
        }

        // Extract events dynamically from single cell per event
        eventsData = [];
        let eventIndex = 1;

        while (data[`Event ${eventIndex}`]) {
          const eventDetails = data[`Event ${eventIndex}`].split(";");
          eventsData.push({
            name: eventDetails[0] || "Unnamed Event",
            date: eventDetails[1] || "Unknown Date",
            description: eventDetails[2] || "No description available",
            images: eventDetails[3]
              ? eventDetails[3].split(":")
              : ["img/placeholder-event.jpg"],
            report: eventDetails[4] || "",
            mainImage: eventDetails[3]
              ? eventDetails[3].split(":")[0]
              : "img/placeholder-event.jpg",
          });

          eventIndex++;
        }

        // Process gallery images
        galleryData = data["Gallery"]
          ? data["Gallery"].split(":").map((img) => ({
              url: img,
              title: "Gallery Image",
            }))
          : [];
      }

      // Populate UI with data
      function populateUI() {
        populateClubInfo();
        populateFaculty();
        populateCoordinators();
        populateEvents();
        populateGallery();
        createEventModals();
      }

      // Populate club info
      function populateClubInfo() {
        // Set club logo
        const logoElement = document.getElementById("club-logo");
        logoElement.src = clubData.logo || "img/placeholder-logo.png";
        logoElement.alt = `${clubData.name} Logo`;

        // Set club name and tagline
        document.getElementById("club-name").textContent = clubData.name;

        // Extract first sentence as tagline if possible
        let aboutText = clubData.about;
        let tagline = aboutText;
        const firstSentenceEnd = aboutText.indexOf(".");
        if (firstSentenceEnd > 0) {
          tagline = aboutText.substring(0, firstSentenceEnd + 1);
          aboutText = aboutText.substring(firstSentenceEnd + 1).trim();
        }

        document.getElementById("club-tagline").textContent = tagline;
        document.getElementById("club-description").textContent = aboutText;
        document.getElementById("club-lead").textContent = tagline;

        // Set club badges
        const badgesContainer = document.getElementById("club-badges");
        badgesContainer.innerHTML = `
          <span class="badge bg-light text-dark me-2 mb-2 p-2">
              <i class="fas fa-calendar-alt me-1"></i> Est. 2018
          </span>
          <span class="badge bg-light text-dark me-2 mb-2 p-2">
              <i class="fas fa-users me-1"></i> ${clubData.membersCount}+ Members
          </span>
          <span class="badge bg-light text-dark me-2 mb-2 p-2">
              <i class="fas fa-trophy me-1"></i> ${clubData.awardsCount}+ Awards
          </span>
          <span class="badge bg-light text-dark me-2 mb-2 p-2">
              <i class="fas fa-laptop-code me-1"></i> Weekly Meetings
          </span>
        `;
      }

      // Populate faculty section
      function populateFaculty() {
        const facultyContainer = document.getElementById("faculty-container");
        facultyContainer.innerHTML = ""; // Clear existing content

        if (facultyData.length === 0) {
          facultyContainer.innerHTML =
            '<div class="col-12 text-center"><p>No faculty advisors found.</p></div>';
          return;
        }

        facultyData.forEach((faculty) => {
          const facultyCard = document.createElement("div");
          facultyCard.className = "col-md-4 col-sm-6 mb-4";
          facultyCard.innerHTML = `
            <div class="faculty-card bg-white p-4">
                <div class="d-flex align-items-center mb-3">
                    <img src="${faculty.image}" alt="${faculty.name}" class="faculty-img me-3">
                    <div>
                        <h5 class="mb-1">${faculty.name}</h5>
                        <p class="text-muted mb-0">${faculty.position}</p>
                    </div>
                </div>
                <div class="mt-3">
                    <p class="mb-2">
                        <i class="fas fa-envelope text-primary me-2"></i>
                        <a href="mailto:${faculty.email}" class="text-decoration-none">${faculty.email}</a>
                    </p>
                    <p class="mb-0">
                        <i class="fas fa-phone text-primary me-2"></i>
                        <a href="tel:${faculty.phone}" class="text-decoration-none">${faculty.phone}</a>
                    </p>
                </div>
            </div>
          `;
          facultyContainer.appendChild(facultyCard);
        });
      }

      // Populate coordinators section
      function populateCoordinators() {
        const coordinatorContainer = document.getElementById(
          "coordinator-container"
        );
        coordinatorContainer.innerHTML = ""; // Clear existing content

        if (coordinatorData.length === 0) {
          //  coordinatorContainer.innerHTML = '<div class="col-12 text-center"><p>No student coordinators found.</p></div>';
          document.getElementById("student-coordinator").style.display = "none";
          return;
        }
        coordinatorData.forEach((coordinator) => {
          const coordinatorCard = document.createElement("div");
          coordinatorCard.className = "col-md-3 col-sm-6 mb-4";
          coordinatorCard.innerHTML = `
            <div class="coordinator-card bg-white p-4">
                <div class="text-center mb-3">
                    <h5 class="mb-1">${coordinator.name}</h5>
                    <p class="text-muted mb-0">${coordinator.position}</p>
                </div>
                <div class="mt-3">
                    <p class="mb-2 small">
                        <i class="fas fa-envelope text-primary me-2"></i>
                        <a href="mailto:${coordinator.email}" class="text-decoration-none">${coordinator.email}</a>
                    </p>
                    <p class="mb-0 small">
                        <i class="fas fa-phone text-primary me-2"></i>
                        <a href="tel:${coordinator.phone}" class="text-decoration-none">${coordinator.phone}</a>
                    </p>
                </div>
            </div>
          `;
          coordinatorContainer.appendChild(coordinatorCard);
        });
      }

      // Populate events section
      function populateEvents() {
        const eventsContainer = document.getElementById("events-container");
        eventsContainer.innerHTML = ""; // Clear existing content

        if (eventsData.length === 0) {
          eventsContainer.innerHTML =
            '<div class="col-12 text-center"><p>No events found.</p></div>';
          return;
        }

        eventsData.forEach((event, index) => {
          const eventCard = document.createElement("div");
          eventCard.className = "col-md-4 mb-4";
          eventCard.innerHTML = `
            <div class="event-card bg-white">
                <div class="event-img-container">
                    <img src="${event.mainImage}" alt="${
            event.name
          }" class="event-img">
                    <div class="achievement-badge">${event.date}</div>
                </div>
                <div class="p-4">
                    <h4 class="mb-3">${event.name}</h4>
                    <p>${event.description.substring(0, 120)}${
            event.description.length > 120 ? "..." : ""
          }</p>
                    <button class="btn btn-outline-primary mt-2" data-bs-toggle="modal" data-bs-target="#eventModal-${index}">
                        <i class="fas fa-info-circle me-1"></i> View Details
                    </button>
                </div>
            </div>
          `;
          eventsContainer.appendChild(eventCard);
        });

        createEventModals();
      }

      // Create event modals
      function createEventModals() {
        const modalsContainer = document.getElementById("modals-container");
        modalsContainer.innerHTML = ""; // Clear existing content

        eventsData.forEach((event, index) => {
          const eventImages = event.images
            .map(
              (img) => `
            <div class="col-md-4 col-6 mb-3">
                <a href="${img}" data-lightbox="event-${index}" data-title="${event.name}">
                    <img src="${img}" alt="${event.name}" class="event-gallery-img w-100">
                </a>
            </div>
          `
            )
            .join("");

          const modal = document.createElement("div");
          modal.className = "modal fade";
          modal.id = `eventModal-${index}`;
          modal.setAttribute("tabindex", "-1");
          modal.setAttribute("aria-labelledby", `eventModalLabel-${index}`);
          modal.setAttribute("aria-hidden", "true");

          modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="eventModalLabel-${index}">${
            event.name
          }</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-4">
                            <img src="${event.mainImage}" alt="${
            event.name
          }" class="img-fluid rounded mb-3 w-100" style="max-height:300px;object-fit:cover;">
                            <div class="d-flex align-items-center mb-3">
                                <span class="badge bg-primary me-2">
                                    <i class="fas fa-calendar-alt me-1"></i> ${
                                      event.date
                                    }
                                </span>
                            </div>
                            <p>${event.description}</p>
                        </div>
                        ${
                          eventImages
                            ? `<h5>Event Gallery</h5><div class="row">${eventImages}</div>`
                            : ""
                        }
                        ${
                          event.report
                            ? `<a href="${event.report}" target="_blank" class="btn btn-primary mt-3">
                            <i class="fas fa-file-pdf"></i> View Report
                        </a>`
                            : ""
                        }
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
          `;

          modalsContainer.appendChild(modal);
        });
      }

      // Populate gallery section
      function populateGallery() {
        const galleryContainer = document.getElementById("gallery-container");
        galleryContainer.innerHTML = ""; // Clear existing content

        if (galleryData.length === 0) {
          galleryContainer.innerHTML =
            '<div class="col-12 text-center"><p>No gallery images found.</p></div>';
          return;
        }

        galleryData.forEach((image) => {
          const galleryItem = document.createElement("div");
          galleryItem.className = "col-md-3 col-sm-6 mb-4";
          galleryItem.innerHTML = `
            <a href="${image.url}" data-lightbox="club-gallery" data-title="${image.title}">
                <img src="${image.url}" alt="${image.title}" class="event-gallery-img w-100">
            </a>
          `;
          galleryContainer.appendChild(galleryItem);
        });
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        // Load club data from Excel
        readExcelFile();

        // Set up event listeners
        document
          .getElementById("register-btn")
          .addEventListener("click", function (e) {
            e.preventDefault();
            alert("Registration coming soon! Please check back later.");
          });
      });
    </script>
  </body>
</html>
